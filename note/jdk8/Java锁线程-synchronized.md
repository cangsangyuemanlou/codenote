# synchronized

[TOC]

线程安全：指，在并发的情况下，该代码经过多线程使用，线程的调度不影响任何结果。

synchronized是一种同步锁。

四种修饰对象：

- 修饰一个代码块
- 修饰一个方法
- 修饰一个静态方法
- 修饰一个类





## 修饰代码块

对象锁：每个对象都有一把锁。线程进入代码块的时候检查能否获得该锁，执行完之后释放锁。

互斥，一次只能有一个线程获得锁；

如果，A获得锁，B无法进入只有等待，直到A释放；如果A一直不释放，B将一直等待。

### 1. synchronized(this)

锁就是该对象。可根据 == 符判断是否是同一个对象。

### 2. synchronized(obj)

指定对象作为锁。

> 当线程A访问一个synchronized对象块的时候，线程B可以访问非synchronized块的代码

## 修饰方法

同步整个方法，锁是调用该方法的对象。

```java
public synchronized void run() {
  //...
}
```

1 synchronized不是方法定义的一部分，因此不能被继承；子类访问父类的同步方法，依然是同步的；

2 接口中不能定义synchronized方法

3 构造方法，不能使用synchronized关键字修饰，但是可以使用synchronized方法块

## 修饰静态方法

静态方法属于类，因此，synchronized静态方法锁定的是这个类的所有对象。

只要是这个类的对象，都认为是同一把锁。

```java
public synchronized static void method() {
  //...
}
```

## 修饰类

```java
synchronized(A.class) {
  
}
```

作用于类时，是给类加锁，所有对象都属于同一把锁。



----

总结：

1 作用在方法或者对象上，锁是对象级别；作用在静态方法或者类上，锁是类级别，所有该类的对象都是同一把锁。

2 每个对象只有一把锁。互斥。

3 同步的代价是系统开销和性能损耗，避免无谓的同步。







